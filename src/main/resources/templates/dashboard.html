<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head('Dashboard')}"></head>

<body>
    <!-- Top Navbar Fragment -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="main-container">
        <header class="page-header">
            <div class="welcome-box">
                <h1 class="page-title" th:if="${userEmployee != null}">
                    Hello, <span style="color: var(--primary);" th:text="${userEmployee.firstName}">Employee</span> ðŸ‘‹
                </h1>
                <p class="page-subtitle">
                    <i class="far fa-calendar-alt"></i> Today is <span
                        th:text="${#temporals.format(#temporals.createNow(), 'EEEE, dd MMMM yyyy')}">Monday, 24 February
                        2026</span>
                </p>
            </div>

            <div th:if="${userEmployee != null}" class="badge"
                style="background: white; border: 1px solid var(--border); padding: 0.6rem 1.25rem; border-radius: 50px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 0.75rem;">
                <span
                    style="width: 10px; height: 10px; background: #22c55e; border-radius: 50%; box-shadow: 0 0 8px rgba(34, 197, 94, 0.4);"></span>
                <span style="font-size: 0.85rem; font-weight: 600; color: var(--text-dark);"
                    th:text="${userEmployee.role}">ROLE_USER</span>
            </div>
        </header>

        <!-- Stats Overview (Employee Personal Stats) -->
        <div class="grid-3" style="margin-bottom: 3rem;">
            <div class="stat-card card">
                <div
                    style="width: 56px; height: 56px; background: var(--secondary-light); color: var(--secondary); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                    <i class="fas fa-umbrella-beach"></i>
                </div>
                <div>
                    <span class="stat-label">Leave Balance</span>
                    <div class="stat-value" th:text="${totalLeaveBalance != null ? totalLeaveBalance : '0'}">0</div>
                    <div class="stat-meta">Days Available</div>
                </div>
            </div>
            <div class="stat-card card">
                <div
                    style="width: 56px; height: 56px; background: var(--primary-light); color: var(--primary); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                    <i class="fas fa-bell"></i>
                </div>
                <div>
                    <span class="stat-label">Notifications</span>
                    <div class="stat-value" th:text="${notifications != null ? notifications.size() : '0'}">0</div>
                    <div class="stat-meta">Unread Alerts</div>
                </div>
            </div>
            <div class="stat-card card">
                <div
                    style="width: 56px; height: 56px; background: #ecfdf5; color: #059669; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <div>
                    <span class="stat-label">Performance Rating</span>
                    <div th:if="${latestReview != null && latestReview.managerRating != null}" class="stat-value"
                        th:text="${latestReview.managerRating + '/5'}">5.0/5</div>
                    <div th:if="${latestReview == null || latestReview.managerRating == null}" class="stat-value">N/A
                    </div>
                    <div th:if="${latestReview != null && latestReview.managerFeedback != null}" class="stat-meta"
                        th:text="${latestReview.managerFeedback}">Keep it up!</div>
                    <div th:if="${latestReview == null || latestReview.managerFeedback == null}" class="stat-meta">No
                        recent rating</div>
                </div>
            </div>
        </div>

        <div class="content-row" style="display: grid; grid-template-columns: 1.6fr 1fr; gap: 2.5rem;">
            <!-- Announcements Section -->
            <section class="card" style="padding: 2rem;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
                    <h2
                        style="font-size: 1.15rem; font-weight: 700; margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-bullhorn" style="color: var(--primary);"></i> Company Updates
                    </h2>
                    <a href="/announcements" class="btn btn-secondary"
                        style="font-size: 0.75rem; padding: 0.4rem 1rem; background: var(--bg); border: none;">
                        See More
                    </a>
                </div>

                <div style="display: flex; flex-direction: column; gap: 1.25rem;">
                    <article th:each="ann : ${announcements}" class="item-card"
                        style="padding: 1.5rem; background: #f8fafc; border-radius: 12px; border: 1px solid #f1f5f9; transition: var(--transition);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem; flex-wrap: wrap; gap: 0.5rem;">
                            <h3 style="font-size: 0.95rem; font-weight: 600; color: var(--text-dark); margin: 0;"
                                th:text="${ann.title}">Title</h3>
                            <time style="font-size: 0.75rem; color: var(--text-muted); font-weight: 500;"
                                th:text="${#temporals.format(ann.createdAt, 'dd MMM yyyy')}">Date</time>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-muted); line-height: 1.6; margin: 0;"
                            th:text="${ann.message}">Message...</p>
                    </article>

                    <div th:if="${#lists.isEmpty(announcements)}"
                        style="padding: 3rem; text-align: center; color: var(--text-muted); border: 2px dashed #f1f5f9; border-radius: 12px;">
                        <i class="fas fa-box-open" style="font-size: 2rem; opacity: 0.2; margin-bottom: 1rem;"></i>
                        <p style="font-size: 0.875rem;">No new announcements today.</p>
                    </div>
                </div>
            </section>

            <!-- Quick Notifications Sidebar -->
            <section class="card" style="padding: 2rem;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
                    <h2
                        style="font-size: 1.15rem; font-weight: 700; margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-bell" style="color: var(--primary);"></i> Recent Alerts
                    </h2>
                    <a href="/notifications" class="btn btn-secondary"
                        style="font-size: 0.75rem; padding: 0.4rem 1rem; background: var(--bg); border: none;">
                        Inbox
                    </a>
                </div>

                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div th:each="note : ${notifications}" th:if="${noteStat.index < 5}"
                        style="padding: 1.25rem; border-radius: 12px; background: white; border: 1px solid #f1f5f9; transition: var(--transition);"
                        th:styleappend="${note.isRead == 0} ? 'border-left: 4px solid var(--primary); background: #f8faff;' : ''">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 0.5rem;">
                            <span
                                style="font-size: 0.65rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 0.05em;"
                                th:text="${note.type ?: 'Alert'}">Update</span>
                            <span style="font-size: 0.7rem; color: var(--text-muted);"
                                th:text="${#temporals.format(note.createdAt, 'HH:mm')}">Time</span>
                        </div>
                        <p style="font-size: 0.875rem; color: var(--text-dark); margin: 0; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;"
                            th:text="${note.message}">Message...</p>
                    </div>

                    <div th:if="${#lists.isEmpty(notifications)}"
                        style="text-align: center; padding: 2rem; color: var(--text-muted);">
                        <p style="font-size: 0.875rem;">All caught up!</p>
                    </div>
                </div>
            </section>
        </div>
    </main>
</body>

</html>